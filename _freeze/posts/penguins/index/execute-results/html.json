{
  "hash": "52e79a7d5b87c77cd3b209b67549daff",
  "result": {
    "markdown": "---\ntitle: \"Palmerpenquins tidymodels\"\nauthor: \"Edward F. Hillenaar\"\ndate: \"05 april, 2024\"\nnumber-sections: true\nformat: \n  html: \n    theme: \n      dark: darkly\nfig-width: 8\nfig-height: 4\ncode-fold: true\neditor: visual\nbibliography: penguins.bib\nnocite: |\n  @*\ncsl: apa-6th-edition.csl\nimage: \"image.jpg\"\n---\n\n\n## Get started with tidymodels and #TidyTuesday Palmer penguins\n\nThis is a blogpost of Julia Silge about rstats tidymodels: [Julia Silge's youtube video](https://juliasilge.com/blog/palmer-penguins/).\n\n\n\n\n\n## Palmerpenguins dataset\n\nThe `Palmerpenguins` dataset can be found here: [Palmerpenguins dataset](https://allisonhorst.github.io/palmerpenguins/).\n\nWe can build a classification model to distinguish male and female penguins.\n\n## Explore data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(penguins)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 344\nColumns: 8\n$ species           <fct> Adelie, Adelie, Adelie, Adelie, Adelie, Adelie, Adel…\n$ island            <fct> Torgersen, Torgersen, Torgersen, Torgersen, Torgerse…\n$ bill_length_mm    <dbl> 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, …\n$ bill_depth_mm     <dbl> 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, …\n$ flipper_length_mm <int> 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186…\n$ body_mass_g       <int> 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, …\n$ sex               <fct> male, female, female, NA, female, male, female, male…\n$ year              <int> 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007…\n```\n:::\n\n```{.r .cell-code}\npenguins %>% \n  filter(!is.na(sex)) %>% \n  ggplot(aes(flipper_length_mm, bill_length_mm, color = sex, size = body_mass_g)) +\n  geom_point(alpha = 0.7) +\n  facet_wrap(~species)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=768}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_df <- penguins %>%\n  filter(!is.na(sex)) %>%\n  select(-year, -island)\n```\n:::\n\n\n## Build a model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\n\npenguin_split <- initial_split(penguins_df, strata = sex)\npenguin_train <- training(penguin_split)\npenguin_test <- testing(penguin_split)\n\nlibrary(rsample)\n# Set seed for reproducibility\nset.seed(123)\n\n# Ungroup the data if it's grouped\npenguin_train <- ungroup(penguin_train)\n\n# Number of bootstrap replicates\nnum_replicates <- 250\n\n# Create an empty list to store bootstrap samples\npenguin_boot <- vector(\"list\", num_replicates)\n\n# Perform bootstrap resampling\nfor (i in 1:num_replicates) {\n  # Generate random indices with replacement\n  indices <- sample(nrow(penguin_train), replace = TRUE)\n  # Extract bootstrap sample using the random indices\n  penguin_boot[[i]] <- penguin_train[indices, ]\n}\n\n# View the first bootstrap sample\npenguin_boot[[1]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 249 × 6\n   species   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex   \n   <fct>              <dbl>         <dbl>             <int>       <int> <fct> \n 1 Adelie              38.3          19.2               189        3950 male  \n 2 Gentoo              48.6          16                 230        5800 male  \n 3 Adelie              41.5          18.5               201        4000 male  \n 4 Adelie              37            16.9               185        3000 female\n 5 Gentoo              49.6          16                 225        5700 male  \n 6 Adelie              37.7          19.8               198        3500 male  \n 7 Adelie              32.1          15.5               188        3050 female\n 8 Chinstrap           42.5          17.3               187        3350 female\n 9 Adelie              38.8          17.6               191        3275 female\n10 Chinstrap           51.3          18.2               197        3750 male  \n# ℹ 239 more rows\n```\n:::\n:::\n\n\n## Setting up a (regression) model to train the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglm_spec <- logistic_reg() %>%\n  set_engine(\"glm\")\n\nrf_spec <- rand_forest() %>%\n  set_mode(\"classification\") %>%\n  set_engine(\"ranger\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npenguin_wf <- workflow() %>%\n  add_formula(sex ~ .)\n\npenguin_wf\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n══ Workflow ════════════════════════════════════════════════════════════════════\nPreprocessor: Formula\nModel: None\n\n── Preprocessor ────────────────────────────────────────────────────────────────\nsex ~ .\n```\n:::\n:::\n\n\n\n\n## Evaluate modeling\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncollect_metrics(rf_rs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 6\n  .metric     .estimator   mean     n std_err .config             \n  <chr>       <chr>       <dbl> <int>   <dbl> <chr>               \n1 accuracy    binary     0.919     25 0.0164  Preprocessor1_Model1\n2 brier_class binary     0.0570    25 0.00624 Preprocessor1_Model1\n3 roc_auc     binary     0.977     25 0.00807 Preprocessor1_Model1\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncollect_metrics(glm_rs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 6\n  .metric     .estimator   mean     n std_err .config             \n  <chr>       <chr>       <dbl> <int>   <dbl> <chr>               \n1 accuracy    binary     0.919     25 0.0174  Preprocessor1_Model1\n2 brier_class binary     0.0558    25 0.00910 Preprocessor1_Model1\n3 roc_auc     binary     0.981     25 0.00770 Preprocessor1_Model1\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglm_rs %>%\n  conf_mat_resampled()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 3\n  Prediction Truth   Freq\n  <fct>      <fct>  <dbl>\n1 female     female  4.52\n2 female     male    0.4 \n3 male       female  0.4 \n4 male       male    4.64\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglm_rs %>%\n  collect_predictions() %>%\n  group_by(id) %>%\n  roc_curve(sex, .pred_female) %>%\n  ggplot(aes(1 - specificity, sensitivity, color = id)) +\n  geom_abline(lty = 2, color = \"gray80\", size = 1.5) +\n  geom_path(show.legend = FALSE, alpha = 0.6, size = 1.2) +\n  coord_equal()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=768}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npenguin_final <- penguin_wf %>%\n  add_model(glm_spec) %>%\n  last_fit(penguin_split)\n\npenguin_final\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# Resampling results\n# Manual resampling \n# A tibble: 1 × 6\n  splits           id               .metrics .notes   .predictions .workflow \n  <list>           <chr>            <list>   <list>   <list>       <list>    \n1 <split [249/84]> train/test split <tibble> <tibble> <tibble>     <workflow>\n```\n:::\n\n```{.r .cell-code}\ncollect_metrics(penguin_final)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 4\n  .metric     .estimator .estimate .config             \n  <chr>       <chr>          <dbl> <chr>               \n1 accuracy    binary         0.857 Preprocessor1_Model1\n2 roc_auc     binary         0.938 Preprocessor1_Model1\n3 brier_class binary         0.101 Preprocessor1_Model1\n```\n:::\n\n```{.r .cell-code}\ncollect_predictions(penguin_final) %>% conf_mat(sex, .pred_class)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          Truth\nPrediction female male\n    female     37    7\n    male        5   35\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npenguin_final$.workflow[[1]] %>%\n  tidy(exponentiate = TRUE) %>% arrange(estimate)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7 × 5\n  term              estimate std.error statistic     p.value\n  <chr>                <dbl>     <dbl>     <dbl>       <dbl>\n1 (Intercept)       5.75e-46  19.6        -5.31  0.000000110\n2 speciesGentoo     1.14e- 5   3.75       -3.03  0.00243    \n3 speciesChinstrap  1.37e- 4   2.34       -3.79  0.000148   \n4 body_mass_g       1.01e+ 0   0.00176     4.59  0.00000442 \n5 flipper_length_mm 1.06e+ 0   0.0611      0.926 0.355      \n6 bill_length_mm    1.91e+ 0   0.180       3.60  0.000321   \n7 bill_depth_mm     8.36e+ 0   0.478       4.45  0.00000868 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>%\n  filter(!is.na(sex)) %>%\n  ggplot(aes(bill_depth_mm, bill_length_mm, color = sex, size = body_mass_g)) +\n  geom_point(alpha = 0.7) +\n  facet_wrap(~species)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=768}\n:::\n:::\n\n\n## References\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}